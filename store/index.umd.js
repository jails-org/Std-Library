(function(n,a){typeof exports=="object"&&typeof module!="undefined"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(n=typeof globalThis!="undefined"?globalThis:n||self,a(n.store={}))})(this,(function(n){"use strict";function a(d,u){let l=[],r=!1;const o=new Set,c=b(d),p=()=>c,y=e=>{if(e.call)return o.add(e),()=>{o.delete(e)};{const i=(t,{action:s,payload:f})=>{s in e&&e[s].call(null,t,{action:s,payload:f})};return o.add(i),()=>{o.delete(i)}}},h=(e,i={})=>(l.push({action:e,payload:i}),new Promise(t=>{r||g(t)})),g=e=>{for(r=!0;l.length;){const i=l.slice();l=[];for(const{action:t,payload:s}of i){if(!(t in u)){console.log(`[Oni] Error -> No action [ ${t} ] found.`);continue}const f=u[t].call(null,c,s,{getState:p,subscribe:y,dispatch:h});Object.assign(c,f),o.forEach(S=>S(c,{action:t,payload:s}))}}r=!1,e(c)};return{getState:p,subscribe:y,dispatch:h,destroy:()=>o.clear()}}const b=d=>JSON.parse(JSON.stringify(d));n.Store=a,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})}));
